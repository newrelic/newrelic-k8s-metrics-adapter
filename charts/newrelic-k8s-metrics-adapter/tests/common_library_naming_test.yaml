suite: test naming helpers
templates:
  - templates/adapter-clusterrolebinding.yaml
  - templates/adapter-rolebinding.yaml
  - templates/configmap.yaml
  - templates/deployment.yaml
  - templates/hpa-clusterrole.yaml
  - templates/hpa-clusterrolebinding.yaml
  - templates/secret.yaml
  - templates/service.yaml
  - templates/apiservice/job-patch/clusterrole.yaml
  - templates/apiservice/job-patch/clusterrolebinding.yaml
  - templates/apiservice/job-patch/job-createSecret.yaml
  - templates/apiservice/job-patch/job-patchAPIService.yaml
  - templates/apiservice/job-patch/psp.yaml
  - templates/apiservice/job-patch/rolebinding.yaml
  - templates/apiservice/job-patch/serviceaccount.yaml
release:
  name: my-release
  namespace: my-namespace
tests:
  - it: default values has its name correctly defined
    set:
      personalAPIKey: 21321
      config:
        accountID: 11111111
    asserts:
      - matchRegex:
          path: metadata.name
          pattern: ^nri-my-release-newrelic-k8s-metrics-adapter($|-apiservice|-hpa-controller|:external-metrics|:system:auth-delegator)

  - it: name of the release is not duplicated
    set:
      personalAPIKey: 21321
      config:
        accountID: 11111111
    release:
      name: newrelic-k8s-metrics-adapter
    asserts:
      - matchRegex:
          path: metadata.name
          pattern: ^nri-newrelic-k8s-metrics-adapter($|-apiservice|-hpa-controller|:external-metrics|:system:auth-delegator)

  - it: name of the release is overridable
    set:
      personalAPIKey: 21321
      nameOverride: test
      config:
        accountID: 11111111
    asserts:
      - matchRegex:
          path: metadata.name
          pattern: ^nri-my-release-test($|-apiservice|-hpa-controller|:external-metrics|:system:auth-delegator)

  - it: name of the release is overridable with the release name
    set:
      nameOverride: my-release
      personalAPIKey: 21321
      config:
        accountID: 11111111
    asserts:
      - matchRegex:
          path: metadata.name
          pattern: ^nri-my-release($|-apiservice|-hpa-controller|:external-metrics|:system:auth-delegator)

  - it: nri- preffix does not duplicate
    set:
      personalAPIKey: 21321
      config:
        accountID: 11111111
    release:
      name: nri-bundle
    asserts:
      - matchRegex:
          path: metadata.name
          pattern: ^nri-bundle-newrelic-k8s-metrics-adapter($|-apiservice|-hpa-controller|:external-metrics|:system:auth-delegator)

  - it: full name override
    set:
      personalAPIKey: 21321
      fullnameOverride: fno
      config:
        accountID: 11111111
    asserts:
      - matchRegex:
          path: metadata.name
          pattern: ^fno($|-apiservice|-hpa-controller|:external-metrics|:system:auth-delegator)
