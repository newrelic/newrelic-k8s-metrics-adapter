suite: test naming helpers for deployment's container, env and volumes
templates:
  - templates/deployment.yaml
  - templates/configmap.yaml
  - templates/secret.yaml
release:
  name: my-release
  namespace: my-namespace
tests:
  - it: container has its name correctly defined
    set:
      personalAPIKey: 21321
      config:
        accountID: 11111111
    asserts:
      - equal:
          path: spec.template.spec.containers[0].name
          value: newrelic-k8s-metrics-adapter
        template: templates/deployment.yaml
  - it: NEWRELIC_API_KEY env SecretKeyRef has its name correctly defined
    set:
      personalAPIKey: 21321
      config:
        accountID: 11111111
    asserts:
      - equal:
          path: spec.template.spec.containers[0].env[1].valueFrom.secretKeyRef.name
          value: nri-my-release-newrelic-k8s-metrics-adapter
        template: templates/deployment.yaml
  - it: tls-key-cert-pair volume has the secretName correctly defined
    set:
      personalAPIKey: 21321
      config:
        accountID: 11111111
    asserts:
      - equal:
          path: spec.template.spec.volumes[0].secret.secretName
          value: nri-my-release-newrelic-k8s-metrics-adapter-apiservice
        template: templates/deployment.yaml
  - it: tls-key-cert-pair volume has the config name correctly defined
    set:
      personalAPIKey: 21321
      config:
        accountID: 11111111
    asserts:
      - equal:
          path: spec.template.spec.volumes[1].configMap.name
          value: nri-my-release-newrelic-k8s-metrics-adapter
        template: templates/deployment.yaml
